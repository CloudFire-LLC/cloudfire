import PlanBadge from "@/components/PlanBadge";
import Alert from "@/components/DocsAlert";
import SupportOptions from "@/components/SupportOptions";

<PlanBadge plans={["starter", "enterprise"]}>

# Configure DNS

</PlanBadge>

Firezone includes a sophisticated DNS routing system built into each client that
provides Split DNS, DNS-based connection routing, and upstream server
configuration for all users of the Firezone client applications.

## How DNS works in Firezone

When a client authenticates with Firezone, it configures its host operating
system to use a special, lightweight DNS proxy running inside Firezone for all
DNS queries on the system.

The IP addresses the proxy chooses to "listen on" are determined by the
[upstream resolvers](#configuring-client-dns-upstream-resolvers) available to
the client. For each IPv4 upstream resolver, the proxy listens on an address in
the `100.100.111.0/24` range, and for each IPv6 upstream resolver, the proxy
listens on an address in the `fd00:2021:1111:8000:100:100:111:0/120` range.

<Alert color="info">
  The embedded proxy doesn't actually _bind_ to these addresses as a traditional
  DNS server process would. Rather, it intercepts all DNS query packets destined
  to these addresses in order to react accordingly.
</Alert>

When an application makes a DNS query, the proxy checks if the name is a
Firezone resource that the user has access to. If it is, the client then
requests a gateway serving that resource to resolve the query. When the gateway
responds, the proxy will map the response IP(s) to

immediately responds with appropriate dummy IPs in the `100.64.96.0/11` and
`fd00:2021:1111:8000/108` range and returns these to the application making the
query. These IPs are remembered for the duration of the client's session and
used to intelligently route subsequent packets to a Firezone gateway suitable
for serving that resource.

If the proxy sees a query for a name that **is not** a Firezone resource that
the user has access to, it will forward the query to the upstream DNS server(s)
configured by the admin in `Settings` -> `DNS`. If no upstream DNS servers are
configured, the query is forwarded to the client device's default system
resolver(s) instead.

This means that clients are automatically configured for Split DNS in Firezone
-- no other configuration is necessary other than adding the desired resources
in the admin portal.

## Configuring client DNS upstream resolvers

Upstream DNS in the clients can be overridden with servers of your choosing so
that clients' queries will use the servers you specify for all non-Firezone
resources.

For DNS names that don't match a defined resource, Firezone will use the
upstream resolvers defined at `Settings` -> `DNS` in the order they are defined.

If no custom resolvers are configured, Firezone clients will fall back to their
default system resolver, typically set by the DHCP server of their local
network.

To add custom resolvers, enter a valid IPv4 or IPv6 address and click "Save". To
remove, delete the IP address and click "Save".

<Alert color="info">
  Custom resolvers such as
  [Cloudflare](https://developers.cloudflare.com/1.1.1.1/setup/#1111-for-families)
  or [NextDNS](https://nextdns.io") can be used to block malware, ads, adult
  material and other content for all users in your Firezone account.
</Alert>

## Configuring Gateway resolvers

Firezone makes no assumptions about the DNS environment in which the gateway
runs. It uses the default system resolver you've configured on the gateway host.

This resolver is used for DNS resources defined in your Firezone account so it's
important that your gateway host has DNS configured properly for clients to
resolve names successfully.

<SupportOptions />
